{% extends "base.html" %}

{% load staticfiles %}
{% load fb_versions %}

{% block title %}
    {{article.title|safe}}
{% endblock %}

{% block seo_fields %}

    <meta name="description" content="{{article.cached_summary_text_no_html|truncatechars:190}}">
    <meta property="og:title" content="{{article.title}}"/>
    <meta property="og:type" content="article"/>


    {% with image_url=article.cached_primary_image %}
	{% if image_url %}
	    <meta property="og:image"
		  content="{% if image_url.0 == '/' %}http://{{request.META.HTTP_HOST}}{% endif %}{{article.cached_primary_image}}"/>
	{% endif %}
    {% endwith %}

    <meta property="og:url" content="{{ request.build_absolute_uri }}"/>
    <meta property="og:description"
	  content="{{ article.cached_summary_text_no_html }}"/>


{% endblock %}


{% block additional_head %}
    {{block.super}}
    {% if article.activate_slideshow %}
	<link rel="stylesheet"
	      href="{% static 'newsroom/css/pgwslider.min.css' %}">
	</link>
    {% endif %}
    {% if can_edit %}
	<script src="//cdn.ckeditor.com/4.5.6/standard-all/ckeditor.js"></script>
	<script src="{% static 'newsroom/js/ck_styles.js' %}"></script>
	<script src="{% static 'newsroom/js/ck_init.js' %}"></script>
    {% endif %}
    {{article.additional_head_scripts|safe}}
{% endblock %}


{% block admin-area-additional %}
    {% if request.user.is_staff %}
	<div id="editing-article">
	</div>
    {% endif %}
{% endblock %}


{% block content %}
    <div class="container">
	<div id="article-content">
	    <article>
		{% block article %}
		    {% include "newsroom/article_block.html" %}
		{% endblock %}
	    </article>
	    <div id="DearReader" class="dearreader"></div>
	    <div  class="row">
		{% if see_also %}
		    <div id="see-also" class="col-xs-12">
			<h2>Related articles</h2>
			<div class="row">
			    <div class="col-xs-12 col-md-12">
				<ul>
				    {% for item in see_also %}
					<li><a href="{{item.get_absolute_url}}
						     ">{{item.title|safe}}</a>
					</li>
				    {% endfor %}
				</ul>
			    </div>
			</div>
		    </div>
		{% endif %}

		{% if read_next %}
		    <div id="read-next" class="col-xs-12">
			<h2>We recommend</h2>
			<div class="row">
			    <div class="col-xs-12 col-md-6">
				{% include 'newsroom/read_next.html' %}
			    </div>
			</div>
		    </div>
		{% endif %}

		{% if most_popular_html %}
		    <div id="most-popular" class="col-xs-12">
			<h2>Most popular</h2>
			<div class="row">
			    <div class="col-xs-12 col-md-6">
				{{most_popular_html|safe}}
			    </div>
			</div>
		    </div>
		{% endif %}
	    </div>
	    <div class="row">

		<div class="col-xs-12" id="newsletter-signup">
		    <a href="http://eepurl.com/Or2a9"
		       class="btn btn-info"
		       role="button">Get GroundUp's
			weekly newsletter</a>
		</div>

		{% if article.copyright %}
		    <div class="col-xs-12" id="article-copyright">
			{{article.copyright|safe}}
		    </div>
		{% endif %}


	    </div>
	    <div class="row">
		<div class="col-xs-12">
		    {% if article.comments_on %}

			<div id="comment-policy">
			    You are welcome to comment. Please <a href="/code-decency">read our policy</a>.
			</div>

			<div id="disqus_thread">
			    <script type="text/javascript">
			     var disqus_shortname = 'groundupnews'; // Required - Replace example with your forum shortname
			     var disqus_identifier = '{% if article.disqus_id %}{{article.disqus_id}}{%else%}GU2_{{article.pk}}{% endif %}';
			     var disqus_url = '{{ request.build_absolute_uri }}';

			     /* * * DON'T EDIT BELOW THIS LINE * * */
			     (function() {
				 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
				 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
			     })();
			    </script> <noscript>Please enable JavaScript to view the <a href=
											"http://disqus.com/?ref_noscript">comments powered by
				Disqus.</a></noscript> <a class="dsq-brlink" href=
							  "http://disqus.com">Comments powered by <span class="logo-disqus">Disqus</span></a>
			</div>

		    {% endif %}
		</div>
	    </div>
	</div>
    </div>
{% endblock %}

{% block javascript-includes %}

    {{block.super}}

    {{article.additional_body_scripts|safe}}

    <script type="text/javascript">
     function getPureArticle()
     {
	 var pure_article = "<h1>" + $("#article_title").text() + "</h1>";
	 if ($("#article_subtitle").length)
	     pure_article += "<h2>" + $("#article_subtitle").text() + "</h2>";
	 if ($(".article-byline").length) {
	     pure_article += "<p>" + $(".article-byline").text() + "</p>";
	 }
	 if ($(".article-dateline").length)
	     pure_article += "<p>" + $(".article-dateline").text() + "</p>";
	 if ($("#article-primary-image").length)
	     pure_article += $("#article-primary-image").html();
	 pure_article += $("#article_body").html();
	 return pure_article;
     }
    </script>
    <!-- Sharing buttons -->
    <script type="text/javascript">
     jQuery(document).ready(function ($) {
	 $('#twitter-share').click(function(){
	     var article_title = encodeURI('{{article.title|addslashes|linebreaksbr|safe}}').
						      substring(0, 115);
	     var url = encodeURI('{{ request.build_absolute_uri }}');
	     var twitter_url = "https://twitter.com/intent/tweet?text=" +
			       article_title + "&url=" + url;
	     var win = window.open(twitter_url, "_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=20%, left=340, width=400, height=400");
	     win.focus();
	     return false;
	 });
	 $('#facebook-share').click(function(){
	     var url = encodeURI('{{ request.build_absolute_uri }}');
	     var facebook_url = "https://www.facebook.com/sharer/sharer.php?u=" + url;
	     var win = window.open(facebook_url, "_blank", "toolbar=no, scrollbars=yes, resizable=yes, top=20%, left=340, width=550, height=400");
	     win.focus();
	     return false;
	 });
	 $('#whatsapp-share').click(function(){
	     var whatsapp_url = 'whatsapp://send?text=' +
				encodeURI('{{ request.build_absolute_uri }}');
	     var win = window.open(whatsapp_url, '_blank');
	     win.focus();
	     return false;
	 });
	 $('#email-share').click(function(){
	     var subject = encodeURI('{{article.title|addslashes|linebreaksbr|safe}}');
	     var body = encodeURI('{{article.cached_summary_text|addslashes|striptags|truncatewords:100|safe}}' + ' ' +
				  '{{ request.build_absolute_uri }}');
	     var mail_url = "mailto:?subject=" + subject + "&body=" + body;
	     var win = window.open(mail_url, '_self');
	     win.focus();
	     return false;
	 });

	 $('#print-article').click(function(){
	     $("aside").remove();
	     var print_contents = getPureArticle();
	     print_contents = "<style>body { margin: 50px; }" +
			      "img { max-width:90%; }</style>" +
			      print_contents;
             return_button = "<p><a href='{{request.build_asolute_uri}}'>Back</a></p>";
             document.body.innerHTML = print_contents;

	     window.print();
             document.body.innerHTML = return_button + print_contents;
	 });

	 {% if can_edit %}

	 var content_div = $('#content-main');

	 $("#publish-now" ).click(function() {
	     $("#input-is-published").val("Now");
	     $("#saveedits").click();
	     return false;
	 });

	 function update_form(editor, field) {
	     document.getElementById(field).value =
	     CKEDITOR.instances[editor].getData();
	 }

	 CKEDITOR.inline( 'article_title', {
	     customConfig: "{% static 'newsroom/js/ck_inline_plaintext_config.js' %}"
	 });
	 CKEDITOR.inline( 'article_subtitle', {
	     customConfig: "{% static 'newsroom/js/ck_inline_basic_config.js' %}"
	 });
	 {% if article.cached_primary_image %}
	 CKEDITOR.inline( 'article_primary_image_caption', {
	     customConfig: "{% static 'newsroom/js/ck_inline_basic_config.js' %}"
	 });
	 {% endif %}

	 CKEDITOR.inline( 'article_body', {
	     customConfig: "{% static 'newsroom/js/ck_inline_config.js' %}"
	 });


	 CKEDITOR.instances.article_title.on('change', function()
	     {
		 update_form("article_title",
			     "id_title");
	     });

	 CKEDITOR.instances.article_subtitle.on('change', function()
	     {
		 update_form("article_subtitle",
			     "id_subtitle");
	     });


	 {% if article.cached_primary_image %}
	 CKEDITOR.instances.article_primary_image_caption.on('change', function()
	     {
		 update_form("article_primary_image_caption",
			     "id_primary_image_caption");
	     });
	 {% endif %}

	 CKEDITOR.instances.article_body.on('change', function()
	     {
		 update_form("article_body",
			     "id_body");
	     });

	 {% include "newsroom/manage_concurrent_updates.js" with pk=article.pk version=article.version %}

	 {% endif %}
     });
    </script>
    {% if article.activate_slideshow %}
	<script src={% static 'newsroom/js/pgwslider.min.js' %}>
	</script>
	<script>
	 $(document).ready(function() {
	     var pgwSlider = $('.pgwSlider').pgwSlider();
	     pgwSlider.reload({
		 displayControls : true,
		 displayList: false
	     });
	 });
	</script>
    {% endif %}
    <script src="http://5.9.195.7:8080/public/js/dearreader.min.js"></script>
{% endblock %}
